// Generated by CoffeeScript 1.8.0
(function() {
  $('window').ready(function() {
    var downloadedBanners, makeHttpRequestTo, queryArray, selectedSeriesBanner;
    queryArray = [];
    downloadedBanners = {};
    selectedSeriesBanner = "";
    $('#search-field').on('focus', function(e) {
      $('#close-distraction-free-search-mode i').removeClass('display-none');
      $('#search-field').removeClass("animate-search-field restore-search-field");
      $('#div-blur-layer').removeClass("animate-blur-layer restore-blur-layer");
      $('#div-search-section').removeClass("animate-search-section restore-search-section");
      $('#search-field').addClass("animate-search-field");
      $('#div-blur-layer').addClass("animate-blur-layer");
      $('#div-search-section').addClass('animate-search-section');
    });
    $('#close-distraction-free-search-mode i').on('click', function(event) {
      $(this).toggleClass("display-none");
      $('#div-search-section').addClass('restore-search-section');
      $('#search-field').addClass("restore-search-field");
      $('#div-blur-layer').addClass("restore-blur-layer");
      $('#search-results-container').empty();
    });
    $('#search-field').on('keyup', function(e) {
      var progressIndicator;
      if (e.keyCode === 13) {
        $('#div-blur-layer').removeClass('hidden');
        $('#div-blur-layer').addClass('visible');
        progressIndicator = $("<div class='progress-indicator'><i class='fa fa-circle-o-notch fa-spin fa-5x'></i></div>");
        $('#search-results-container').prepend(progressIndicator);
        (function(progressIndicator, query) {
          makeHttpRequestTo("http://localhost:8888/series/seriesName/" + query, function(data) {
            var currentSearchResultContainer, querySection, resultSection, seriesArray;
            if (data) {
              data = JSON.parse(data);
              if (data.seriesArray) {
                seriesArray = data.seriesArray;

                /*
                						   searchResultContainer has 2 sections
                						     1 - query section
                						     2 - result section
                 */
                currentSearchResultContainer = $("<div class='search-result'><div class='query'></div><div class='result'></div></div>");
                querySection = currentSearchResultContainer.find('.query');
                resultSection = currentSearchResultContainer.find('.result');
                querySection.append($("<div>").append(query));
                currentSearchResultContainer.insertBefore(progressIndicator);
                progressIndicator.remove();
                (function(seriesArray, resultSection) {
                  var counter, searchResultN, series, _fn, _fn1, _i, _j, _len, _len1;
                  for (_i = 0, _len = seriesArray.length; _i < _len; _i++) {
                    series = seriesArray[_i];
                    resultSection.append($("<div class='search-result-n'>"));
                  }
                  counter = 1;
                  _fn = function(searchResultN) {
                    return searchResultN.on('click', function(event) {
                      if (Modernizr.localstorage) {
                        localStorage.setItem("series-banners", downloadedBanners[searchResultN.data("series-id")]);
                        localStorage.setItem("series-name", searchResultN.data("series-name"));
                        localStorage.setItem("series-id", searchResultN.data("series-id"));
                      } else if (Modernizr.sessionstorage) {
                        sessionStorage.setItem("series-name", searchResultN.data("series-name"));
                        sessionStorage.setItem("series-id", searchResultN.data("series-id"));
                        sessionStorage.setItem("series-banners", downloadedBanners[searchResultN.data("series-id")]);
                      }
                      return downloadedBanners = {};
                    });
                  };
                  _fn1 = function(series, searchResultN) {
                    makeHttpRequestTo("http://localhost:8888/series/seriesId/" + series.id + "/banners", function(data) {
                      var banner, bannerUrl, bannersArray, href, _k, _len2;
                      if (data) {
                        downloadedBanners["" + series.id] = data;
                        bannersArray = JSON.parse(data);
                        bannerUrl = "";
                        for (_k = 0, _len2 = bannersArray.length; _k < _len2; _k++) {
                          banner = bannersArray[_k];
                          if (banner.type === "poster") {
                            bannerUrl = banner.url;
                            break;
                          }
                        }
                        href = "./series.html?series-name=" + (searchResultN.data('series-name')) + "&series-id=" + (searchResultN.data('series-id'));
                        searchResultN.append($(("<a href='" + href + "'><img src=") + bannerUrl + " class='series-artwork'></img></a>"));
                      }
                    });
                  };
                  for (_j = 0, _len1 = seriesArray.length; _j < _len1; _j++) {
                    series = seriesArray[_j];
                    console.log(series);
                    searchResultN = resultSection.find(":nth-child(" + counter + ")");
                    counter++;
                    searchResultN.attr("data-series-id", "" + series.id);
                    searchResultN.attr("data-series-name", "" + series.name);

                    /*
                    									  storing name, id, banners of selected series to storage
                    									 	name ,id to determine series
                    									  banners to prevent again requesting for the data since banner data for specific series was already downlaoded
                     */
                    _fn(searchResultN);
                    searchResultN.append($("<div class='img-tag'><span>" + series.name + "</span></div>"));
                    _fn1(series, searchResultN);
                  }
                })(seriesArray, resultSection);
              }
            }
          });
        })(progressIndicator, $('#search-field').val());
      }
    });
    makeHttpRequestTo = function(reqUrl, callback) {
      return $.ajax({
        url: reqUrl,
        error: function(jqXHR, textStatus, errorThrown) {
          console.log('error');
          callback({
            "errorStatus": "TRUE"
          });
        },
        success: function(data, textStatus, jqXHR) {
          callback(data);
        }
      });
    };
    return;
  });

}).call(this);


//# sourceMappingURL=index.js.map
