(function(){var e,s,n,i,t,r,o,a,u,d,c;c=require("tvdbwebservice"),t=require("express"),s=t(),r=require("fs"),o=require("handlebars"),console.log("starting"),s.set("port",process.env.PORT||5e3),s.set("tvdbApiKey",process.env.TVDB_API_KEY),s.use(t["static"](__dirname+"/public")),c.setTvdbApiKey(s.get("tvdbApiKey")),a=require("./mongodbclient.js"),a.setDbConfig(process.env.DB_USER,process.env.DB_PASSWORD),i=require("cookie-parser"),s.use(i()),d=require("express-session"),e=require("connect-mongo")(d),s.use(d({secret:"67gvgchgch987jbcfgxdfmhye435jvgxzdzf",store:new e({url:"mongodb://"+process.env.DB_USER+":"+process.env.DB_PASSWORD+"@ds029640.mongolab.com:29640/tvserieswebappdatabase",ttl:6048e5}),cookie:{maxAge:6048e5}})),n=require("body-parser"),u=require("multer"),s.use(n.json()),s.use(n.urlencoded({extended:!0})),s.use(u()),s.use(function(e,s,n){s.header("Access-Control-Allow-Origin","*"),s.header("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),n()}),s.get("/series/seriesName/:name",function(e,s){c.getSeriesByName(e.params.name,function(e){s.end(e)})}),s.get("/series/seriesId/:id/seriesPlusActorsPlusBanners",function(e,s){c.getSeriesPlusActorsPlusBannersById(e.params.id,function(e){s.end(e)})}),s.get("/series/seriesId/:id/seriesOnly",function(e,s){c.getSeriesOnlyById(e.params.id,function(e){s.end(e)})}),s.get("/series/seriesId/:id/actors",function(e,s){c.getActorsForSeriesWithId(e.params.id,function(e){s.end(e)})}),s.get("/series/seriesId/:id/banners/",function(e,s){c.getBannersForSeriesWithId(e.params.id,function(e){s.end(e)})}),s.get("/",function(e,s){var n,i,t,a;console.log("welcome to tvseries"),i=r.readFileSync("./index.html","utf8"),n={status:"Sign in",email:"",signout:""},e.session.username&&(n={status:e.session.username,email:e.session.username,signout:"signout"}),a=o.compile(i),t=a(n),console.log("account:",n),s.writeHead(200,{"Context-Type":"text/html"}),s.write(t),s.end()}),s.listen(s.get("port"),function(){console.log("Node app is running at"+s.get("port"))}),s.post("/signup",function(e,s){a.checkIfAlreadyRegistered(e.body.email,function(n){n?(e.session["signin-status"]=!1,s.redirect("/")):a.addNewUser({"first-name":e.body["first-name"],"last-name":e.body["last-name"],username:e.body.username,email:e.body.email,password:e.body.password},function(n){e.session.username=n.username,e.session.password=n.password,e.session.email=n.email,e.session["signin-status"]=!0,s.redirect("/")})})}),s.get("/signin-status",function(e,s){e.session["signin-status"]=e.session.username?!0:!1,s.end(JSON.stringify({"first-name":e.session["first-name"],email:e.session.email,username:e.session.username,"signin-status":e.session["signin-status"]}))}),s.get("/signout",function(e,s){e.session.destroy(function(e){s.redirect("/")})}),s.post("/signin",function(e,s){a.authenticateUserCredentials(e.body.email,e.body.password,function(n){e.session.username=n.username,e.session["signin-status"]=n["signin-status"],s.redirect("/")})})}).call(this);