(function(){var e,s,n,i,r,t,o,a,u,c,d,l,g,p;p=require("tvdbwebservice"),r=require("express"),s=r(),t=require("fs"),d=require("path"),a=require("http"),o=require("handlebars"),o.registerHelper("raw-helper",function(e){return e.fn()}),console.log("starting"),s.set("port",process.env.PORT),s.set("tvdbApiKey",process.env.TVDB_API_KEY),p.setTvdbApiKey(s.get("tvdbApiKey")),u=require("./mongodbclient.js"),u.setDbConfig(process.env.DB_USER,process.env.DB_PASSWORD),i=require("cookie-parser"),s.use(i()),g=require("express-session"),e=require("connect-mongo")(g),s.use(g({secret:"67gvgchgch987jbcfgxdfmhye435jvgxzdzf",store:new e({url:"mongodb://"+process.env.DB_USER+":"+process.env.DB_PASSWORD+"@ds029640.mongolab.com:29640/tvserieswebappdatabase",ttl:6048e5}),cookie:{maxAge:6048e5}})),n=require("body-parser"),c=require("multer"),s.use(n.json()),s.use(n.urlencoded({extended:!0})),s.use(c()),s.use(function(e,s,n){s.header("Access-Control-Allow-Origin","*"),s.header("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),n()}),s.get("/series/seriesName/:name",function(e,s){p.getSeriesByName(e.params.name,function(e){s.end(e)})}),s.get("/series/seriesId/:id/seriesPlusActorsPlusBanners",function(e,s){p.getSeriesPlusActorsPlusBannersById(e.params.id,function(e){s.end(e)})}),s.get("/series/seriesId/:id/seriesOnly",function(e,s){p.getSeriesOnlyById(e.params.id,function(e){s.end(e)})}),s.get("/series/seriesId/:id/actors",function(e,s){p.getActorsForSeriesWithId(e.params.id,function(e){s.end(e)})}),s.get("/series/seriesId/:id/banners/",function(e,s){p.getBannersForSeriesWithId(e.params.id,function(e){s.end(e)})}),s.get("/",function(e,s){var n,i,r,a;console.log("welcome to tvseries"),i=t.readFileSync("public/index.html","utf8"),n={status:"Sign in",email:"",signout:"",toggle:"",signinLink:"/account/sign-in.html "},e.session.username&&(n={status:e.session.username,email:e.session.username,signout:"signout",toggle:"dropdown",signinLink:""}),a=o.compile(i),r=a(n),console.log("account:",n),s.writeHead(200,{"Context-Type":"text/html"}),s.write(r),s.end()}),s.post("/signup",function(e,s){u.checkIfAlreadyRegistered(e.body.email,function(n){n?(e.session["signin-status"]=!1,s.redirect("/")):u.addNewUser({"first-name":e.body["first-name"],"last-name":e.body["last-name"],username:e.body.username,email:e.body.email,password:e.body.password},function(n){e.session.username=n.username,e.session.password=n.password,e.session.email=n.email,e.session["signin-status"]=!0,s.redirect("/")})})}),s.get("/signin-status",function(e,s){e.session["signin-status"]=e.session.username?!0:!1,s.end(JSON.stringify({"first-name":e.session["first-name"],email:e.session.email,username:e.session.username,"signin-status":e.session["signin-status"]}))}),s.get("/signout",function(e,s){e.session.destroy(function(e){s.redirect("/")})}),s.post("/signin",function(e,s){u.authenticateUserCredentials(e.body.email,e.body.password,function(n){e.session.username=n.username,e.session["signin-status"]=n["signin-status"],s.redirect("/")})}),s.use(r["static"](__dirname+"/public")),console.log("Attempting to start server at "+s.get("port")),l=a.createServer(s).listen(s.get("port"),function(){var e,s,n;e=l.address(),console.log("Node app is running at ",e),"darwin"===process.platform&&(n="webapp.tvseries",s=d.resolve(process.env.HOME,".pow/"+n),t.writeFile(s,e.port,function(e){return function(e){var i;return e?console.error(e):(console.log("Hosted on: "+n+".dev"),i=function(){var i;try{t.unlinkSync(s),console.log("Unhosted from: "+n+".dev")}catch(r){if(i=r,e)return console.error(e)}},process.on("SIGINT",function(){i(),process.exit()}),process.on("exit",function(e){i()}))}}(this)))})}).call(this);